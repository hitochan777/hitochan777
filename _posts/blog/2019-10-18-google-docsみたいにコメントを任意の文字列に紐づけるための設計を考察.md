---
layout: blog
title: Google docsみたいにコメントを任意の文字列に紐づけるための設計を考察
date: 2019-10-17T14:38:27.704Z
---
Google docsでは選択したテキストにコメントすることができる。  
Notionでは選択した箇所だけでなく、ブロック全体に対してコメントすることができる。
今回は行と選択された文字列の両方にコメントができるように設計を考える。

# 考慮すべきポイント

* サーバー側でどうデータを永続化するか  
  文章全体を一レコードで管理するか、文やブロックごとに分けて保存するか?
* コメントと文章をどう結びつけるか?

# 実現方法
* コンテンツ内にコメントへのリンクを埋め込む  
  CKEditorが採用している方法。コメントをスレッドごとにまとめ、スレッドにはスレッドIDを持たせる。コンテンツはHTMLとして内部状態をもち、選択された箇所へのコメントは選択された箇所をコメントがあることがわかるようにタグで囲む。タグにはIDとして対応するスレッドIDを指定する。行全体に対してコメントができるかどうかはわからない。もちろん行全体を選択すればコメントはできるが。
  DBにはコンテンツをHTMLとして保存ができる。コメントは別テーブルで持たせて

* DB
