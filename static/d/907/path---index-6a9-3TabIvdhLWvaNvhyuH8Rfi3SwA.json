{"data":{"allMarkdownRemark":{"totalCount":2,"edges":[{"node":{"rawMarkdownBody":"\nf1-micro インスタンスは 3 個以上でないと GKE クラスタが作れないが、  \n一度クラスタを作成してからインスタンスグループをスケーリングすることで一個でのクラスタに変更できる。([参考](https://snyke.net/post/kubernetes-playground/))\nf1-micro はメモリが 0.6GB しかないので、自動でデプロイされるコンテナできちきちな状況。  \nログのコンテナとか色々無効にすれば空きはでるものの ([参考](https://qiita.com/apstndb/items/1c3f8ea026ed6b27e357))、いろんなコンテナデプロイして試すにはやっぱりメモリがある程度欲しいよねってことで n1-standard-1 を使うことにした。  \nn1-standard-1 だとノードの数が 1 個でもクラスタは起動できるみたい。\n\n1. クラスタを作成\n\n   ```bash\n   $ gcloud container clusters create hitochan-cluster \\\n     --machine-type=n1-standard-1 \\\n     --num-nodes=1 \\\n     --disk-size=10 \\\n     --no-enable-cloud-logging \\\n     --enable-autorepair \\\n     --preemptible\n   ```\n\n2. インスタンスグループの一覧を表示して名前をメモしておく。\n\n   ```bash\n   $ gcloud compute instance-groups managed list\n   NAME                                            LOCATION       SCOPE  BASE_INSTANCE_NAME                          SIZE  TARGET_SIZE  INSTANCE_TEMPLATE                           AUTOSCALED\n   gke-hitochan-cluster-default-pool-6618700a-grp  us-central1-a  zone   gke-hitochan-cluster-default-pool-6618700a  1     1            gke-hitochan-cluster-default-pool-6618700a  no\n   ```\n\n3. 2 でメモしたインスタンスグループ名を指定して、インスタンス数を変更する。節約したいので使わないときは 0 にしておく。\n\n   ```bash\n   $ gcloud compute instance-groups managed resize gke-hitochan-cluster-default-pool-6618700a-grp --size=0\n   ```\n","fields":{"slug":"/2019/01/15/gke-cluster-memo/"},"frontmatter":{"title":"GKEでクラスタ作るときのメモ","date":"2019-01-15T00:00:00.000Z"}}},{"node":{"rawMarkdownBody":"\n[gatsby-plugins-typescript](https://www.gatsbyjs.org/packages/gatsby-plugin-typescript/)で GatsbyJS を typescript で使えるようしていた。\nで今日、typescript だから VSCode を使うみたいな状況を避けたかったので、[tsuquyomi](https://github.com/Quramy/tsuquyomi)という便利な Vim の typescript プラグインを入れてみた。\n\nすると、以下のようなエラーで怒られた。\n\n```\nsrc/templates/blog-post.tsx:1:8 - error TS1192: Module '\"/home/hitochan/developer/me/node_modules/@types/react/index\"' has no default export.\n\n1 import React from 'react'\n```\n\nエラーが言っていることは文字通りで、react には `default export` がないのにそれを `import` しようとしてるよ！というエラーだ。\n\n具体的には以下のコード。\n\n```\nimport React from 'react'\n```\n\nなんで今更こんなエラーが出るようになったかというと、\ngatsby-plugins-typescript は型チェックなどはせずに js にトランスパイルするだけなので気づかなかっただけ。\n\n解決策は 2 つ。`tsconfig.json`を追加すれば他のファイルの変更はいらないので今回は 2 にした。\nちなみに`gatsby-plugins-typescript`は`tsconfig.json`に全く影響されないっぽいので、設定は gatsby-config.js でやる必要がある。\n\n1. `import * as React from 'react'`で全ての`export`を`React`として`import`\n2. `tsconfig.json`の`compileOptions`に以下のように`\"esModuleInterop\": true`を設定。\n\n```json\n{\n  \"compilerOptions\": {\n    ...\n    \"esModuleInterop\": true,\n    ...\n  },\n  ...\n}\n```\n","fields":{"slug":"/2019/01/24/gatsby-typescript-allow-synthetic/"},"frontmatter":{"title":"typescriptのvim pluginとgatsby-plugins-typescriptを一緒に使う","date":"2019-01-24T00:00:00.000Z"}}}]}},"pageContext":{}}